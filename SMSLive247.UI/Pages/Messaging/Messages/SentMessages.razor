<Card HeaderTitle="Sent Messages">
    <Body>
        <SearchArea>
            <LeftRight>
                <Left>
                    <SearchBox @ref="searchBox" @onclick="e => ds.LoadData(alert)">
                    </SearchBox>
                </Left>
                <Right>
                    <Button Type="Button.Style.SAVE" @onclick="OpenDownloadFilter">
                        Download
                    </Button>
                </Right>
            </LeftRight>
        </SearchArea>
        <Table DataSource="ds">
            <Columns>
                <Column Header="#"><input class="form-check-input" type="checkbox" /></Column>
                <Column Header="Sender">@context.SenderID</Column>
                <Column Header="Message">@context.MessageText</Column>
                <Column Header="Delivery Report">
                    @(context.TotalProcessed)/@(context.TotalProcessed + context.TotalFailed)<br />
                    @(context.Charged + "ç")<br />
                    @context.MessageParts page(@context.MessageText.Length)
                </Column>
                <Column Header="Time">
                    <FormatDate DateTime="@context.SubmitDate"></FormatDate>
                </Column>
                <Column Header="Action">
                    <Actions OnDelete="e => DeleteMessage(context.BatchID)">
                    </Actions>
                </Column>
            </Columns>
        </Table>
    </Body>
    <Footer>
        <Pager PageState="ds.PageState" OnPageChange="e => ds.SetPage(e).LoadData(alert)" />
    </Footer>
</Card>

<Modal Title="Download" Hidden="@(!showDownloadFilterModal)">
    <Body>
        <FormInputDateRange Label="Select Period" @bind-Value="dateRange"></FormInputDateRange>
        <FormInputText Label="Sender ID" @bind-Value="senderId"></FormInputText>
        <FormInputRadioList Name="downloadType" Label="Download Type" Options="@radioOptions" @bind-Value="downloadType" />
    </Body>
    <Footer>
        <Button Type="Button.Style.SAVE" @onclick="HandleFilterApply">
            Download
        </Button>
    </Footer>
</Modal>

@code {
    private SearchBox searchBox = new();
    private ApiDataSource<SmsBatchResponse> ds = new();
    private bool showDownloadFilterModal = false;
    private FormInputDateRangeValue dateRange = new();
    private string? senderId;
    private string downloadType;

    protected override async Task OnInitializedAsync()
    {
        ds.Callback = new((PageState p, FilterState? f) =>
        {
            return apiClient.SmsBatchListAsync(p.PageNumber, p.PageSize, null, null);
        });

        await ds.LoadData(alert);
    }

    private Task DeleteMessage(long batchId)
    {
        return apiClient.SmsBatchDeleteAsync((int)batchId);
    }

    private void OpenDownloadFilter()
    {
        showDownloadFilterModal = true;
        StateHasChanged();
    }

    private void HandleFilterApply()
    {
        // Handle the filter data here and perform the download operation
        Console.WriteLine($"From Date: {dateRange.StartDate}, To Date: {dateRange.EndDate}, Sender ID: {senderId}, Download Type: {downloadType}");
        showDownloadFilterModal = false;
        StateHasChanged();
    }

    private List<FormInputRadioList.RadioOption> radioOptions = new()
    {
        new FormInputRadioList.RadioOption { Value = "messages", Label = "Messages" },
        new FormInputRadioList.RadioOption { Value = "deliveryReports", Label = "Delivery Reports" }
    };
}
